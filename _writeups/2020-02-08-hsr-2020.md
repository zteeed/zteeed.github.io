---
layout: page
title: HackSecuReims 2020
---

# [Forensic] OldSchool

Voici une solution sur les 6 épreuves de forensic utilisant une machine virtuelle sous Windows 98.
Je vous propose une solution qui ne nécessite pas de booter la machine virtuelle.

## Source de téléchargement

<ul>
  <li><a href="https://download.hackademint.org/hsr_oldschool.ova">hsr_oldschool.ova </a>(sha1sum: 2e7325cf3801520d117d5970c89bee15a42ab172)</li>
</ul>

## Consignes

<ul>
<li>Trouver le flag de l'utilisateur HSR.</li>
<li>L'utilisateur HSR ne semble pas avoir l'habitude de manipuler des fichiers sous Windows 98.</li>
<li>L'utilisateur HSR vous montre ses talents d'artiste sous Windows 98.</li>
<li>L'ordinateur de l'utilisateur HSR semble bizarre, non ?</li>
<li>L'utilisateur HSR ne se rappelle plus des tricks en ligne de commande. Pouvez-vous l'aider à se rémémorer ?</li>
<li>HSR après plusieurs séances sous Windows 98 découvre la joie des "Oeufs de Pâques" fait par les créateurs, notamment lors de leur Bienvenue. Le flag est de la forme HSR{nom de l'argument}</li>
</ul>

## Monter le système de fichiers sur son Linux 

> Un fichier `OVA` est une archive utilisé par des applications de virtualisation telles que VMware Workstation et Oracle VM Virtualbox. Il s'agit d'un package qui contient des fichiers utilisés pour décrire une machine virtuelle, qui comprend un fichier descripteur .OVF, un fichier manifeste facultatif (.MF) et des fichiers de certificat, ainsi que d'autres fichiers associés.

```bash
$ file hsr_oldschool.ova
hsr_oldschool.ova: POSIX tar archive

$ tar xvf hsr_oldschool.ova
vm_hacksecuold.ovf
vm_hacksecuold-disk001.vmdk

$ file vm_hacksecuold-disk001.vmdk
vm_hacksecuold-disk001.vmdk: VMware4 disk image
```

Les données du système de fichiers sont dans le fichier `vm_hacksecuold-disk001.vmdk`.
On ne peut monter en l'état ce disque sur notre système d'exploitation Linux. On va passer par une convertion en `.qcow2` afin de pouvoir monter le disque.

Pour rappel:
> Qcow est un format d'image disque utilisé par QEMU, un hyperviseur de machine virtuelle qui s'exécute à l'intérieur d'un autre système d'exploitation. 

```bash
$ qemu-img convert -f vmdk -O qcow2 vm_hacksecuold-disk001.vmdk vm_hacksecuold-disk001.qcow2
$ sudo modprobe nbd max_part=63
$ sudo qemu-nbd -c /dev/nbd0 ./vm_hacksecuold-disk001.qcow2
$ sudo mount /dev/nbd0p1 /mnt/
```

## FLAG 1

> Trouver le flag de l'utilisateur HSR.

On cherche le pattern du flag `HSR{` partout sur le système de fichiers.

```bash
$ grep -R "HSR{" /mnt
Fichier binaire /mnt/WINDOWS/SYSTEM.DAT correspondant
/mnt/WINDOWS/TEMP/history.txt:echo 'HSR{FAKE_FLAG}'
/mnt/Mes documents/flag.txt:HSR{3asy_Fl@g!!}
Fichier binaire /mnt/RECYCLED/DC0.DOC correspondant
```

On utilisera `strings` par la suite sur les "fichiers binaires" indiqués par `grep`.

## FLAG 2

>  L'utilisateur HSR ne semble pas avoir l'habitude de manipuler des fichiers sous Windows 98.

```bash
$ strings /mnt/RECYCLED/DC0.DOC | grep "HSR{"
HSR{2nd_fl4g_w@rmUp!!}
```

## FLAG 4

>  L'ordinateur de l'utilisateur HSR semble bizarre, non ?

```
$ strings /mnt/WINDOWS/SYSTEM.DAT | grep "HSR{"
CommentHSR{What_a_new_Flag_H3r3}
```

## FLAG 3

> L'utilisateur HSR vous montre ses talents d'artiste sous Windows 98.

On cherche une image probablement en rapport avec HSR, explorons les noms des fichiers...

```bash
$ find /mnt | grep -i HSR
/mnt/WINDOWS/HSR.PWL
/mnt/WINDOWS/TEMP/HSR
/mnt/WINDOWS/TEMP/HSR/flag.txt
/mnt/WINDOWS/TEMP/HSR/real_flag.txt
/mnt/WINDOWS/TEMP/HSR/fake_flag.txt
/mnt/WINDOWS/Cookies/hsr@auto.search.msn[1].txt
/mnt/WINDOWS/Cookies/hsr@msn[2].txt
/mnt/WINDOWS/Cookies/hsr@search[1].txt
/mnt/WINDOWS/Cookies/hsr@bing[1].txt
/mnt/WINDOWS/Cookies/hsr@www.bing[1].txt
/mnt/WINDOWS/Cookies/hsr@google[1].txt
/mnt/WINDOWS/Cookies/hsr@search[2].txt
/mnt/WINDOWS/Hsr.bmp
```

C'est `/mnt/WINDOWS/Hsr.bmp` qui contient le flag:

<img src="/images/writeups/hsr2020/forensic/hsr.bmp" />

## FLAG 5

> L'utilisateur HSR ne se rappelle plus des tricks en ligne de commande. Pouvez-vous l'aider à se rémémorer ?

Lors de notre recherche du `FLAG 1`, on a observé l'existence de `/mnt/WINDOWS/TEMP/history.txt`:

```bash 
$ cat /mnt/WINDOWS/TEMP/history.txt
...
echo 'J u s t c o n c a t m e : H S R { D 0 s K 3 Y _ f 0 r _ c 0 m m a n d _ H 1 s t 0 r Y }'
...

$ cat /mnt/WINDOWS/TEMP/history.txt | tr -d ' ' | grep HSR
echo'HSR{FAKE_FLAG}'
echo'Justconcatme:HSR{D0sK3Y_f0r_c0mmand_H1st0rY}'
```

## FLAG 6


> HSR après plusieurs séances sous Windows 98 découvre la joie des "Oeufs de Pâques" fait par les créateurs, notamment lors de leur Bienvenue. Le flag est de la forme HSR{nom de l'argument}

En cherchant "Easter Egg Windows98" sur Youtube on peut trouver la vidéo explicative suivante:
<a href="https://www.youtube.com/watch?v=hB6lEMlqvbg">https://www.youtube.com/watch?v=hB6lEMlqvbg</a>

On cherche alors ce qui est en rapport avec `WELDATA.exe`

```bash
$ find /mnt | grep -i WELDATA
/mnt/WINDOWS/APPLOG/WELDATA.LGC
/mnt/WINDOWS/Application Data/Microsoft/WELCOME/WELDATA.EXE
/mnt/WINDOWS/Application Data/Microsoft/WELCOME/Raccourci vers Weldata.lnk
```

On cherche alors le flag en supposant qu'il contient `_` ce qui est courant dans les formats de flag.

```bash
$ strings "/mnt/WINDOWS/Application Data/Microsoft/WELCOME/Raccourci vers Weldata.lnk" | grep "_"
You_are_a_real_rascal
```
